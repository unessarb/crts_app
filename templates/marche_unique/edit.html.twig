{% extends 'layouts/base.html.twig' %}

{% block title 'Edit marché' %}

{% block body %}

	<!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Modifier marché</h1>
          </div>
		  <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="{{ path('app_marches') }}">Archive Marché Unique - Cadre - Reconductible</a></li>
              <li class="breadcrumb-item active">Edit marché</li>
            </ol>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>
	<!-- Main content -->
    <section class="content ">
		{{ form_start(form) }}
			<div class="row">
				<div class="col-md-6">
				<div class="card card-primary">
					<div class="card-body">
					{{ form_row(form.numMarche) }}
					{{ form_row(form.tfs) }}
					{{ form_row(form.typeMarche) }}
					{{ form_row(form.modePassassion) }}
					{{ form_row(form.titulaire) }}
					<div class="form-group">
						{{ form_label(form.societe) }}
						<div class="row">
							<div class="col-10">
								{{ form_widget(form.societe) }}
								
							</div>
							<div class="col-2">
								<button type="button" class="btn btn-primary float-right" data-toggle="modal" data-target="#exampleModal"><i class="fa fa-plus"></i>  </button>
							</div>
							
						</div>
					</div>
					
					</div>
					<!-- /.card-body -->
				</div>
				<!-- /.card -->
				</div>
				<div class="col-md-6">
				<div class="card card-secondary">
					<div class="card-body">
					{{ form_row(form.natureOperation) }}
					
					{{ form_row(form.fontionnementInvestissement) }}
					{{ form_row(form.lineBudgetaire) }}
					{{ form_row(form.anneeBudgetaire) }}
					{{ form_row(form.montant) }}
					{{ form_row(form.devise) }}
					</div>
					<!-- /.card-body -->
				</div>
				<!-- /.card -->
				</div>
			</div>
			<div class="card card-secondary">
			<div class="card-header">
			Dossier Lancement et passation
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col-6">
						{{ form_row(form.lettreDeLancementFile) }}
					</div>
					<div class="col-6">
						{{ form_row(form.decisionFile) }}
					</div>
				</div>
				
				<div class="row">
					<div class="col-6">
						{{ form_row(form.avisJournauxFile) }}
					</div>
					<div class="col-6">
						{{ form_row(form.convocationTMFile) }}
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						{{ form_row(form.pvTechniqueFile) }}
					</div>
					<div class="col-6">
						{{ form_row(form.lettreJustificationFile) }}
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						{{ form_row(form.lettreComplementFile) }}
					</div>
					
				</div>
				
			</div>
		<!-- /.card-body -->
		</div>
          <!-- /.card -->


		<div class="card card-secondary">
			<div class="card-header">
			Dossier exécution - Engagement
			</div>
			<div class="card-body">
				
				<div class="row">
					<div class="col-6">
						{{ form_row(form.marcheSigneFile) }}
					</div>
					<div class="col-6">
						{{ form_row(form.certificatAdministratifFile) }}
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						{{ form_row(form.avisJournauxEngagementFile) }}
					</div>
					<div class="col-6">
						{{ form_row(form.cautionFile) }}
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						{{ form_row(form.pouvoirFile) }}
					</div>
					<div class="col-6">
						{{ form_row(form.retenueFile) }}
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						{{ form_row(form.ficheModeleFile) }}
					</div>
					<div class="col-6">
						{{ form_row(form.etatEngagementFile) }}
					</div>
				</div>

				
			</div>
		<!-- /.card-body -->
		</div>
          <!-- /.card -->

		<div class="card card-secondary">
		<div class="card-header">
			Dossier exécution - Paiement
			</div>
			<div class="card-body">
				
				<div class="row">
					<div class="col-6">
						{{ form_row(form.marcheSignePaiementFile) }}
					</div>
					<div class="col-6">
						{{ form_row(form.factureFile) }}
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						{{ form_row(form.ficheInterventionFile) }}
					</div>
					<div class="col-6">
						{{ form_row(form.decomptesFile) }}
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						{{ form_row(form.procesVerbalFile) }}
					</div>
					<div class="col-6">
						{{ form_row(form.bordereauFile) }}
					</div>
				</div>

				<div class="row">
					<div class="col-6">
						{{ form_row(form.ordonnancementFile) }}
					</div>
					<div class="col-6">
						{{ form_row(form.avisVirementFile) }}
					</div>
				</div>

				
			</div>
		<!-- /.card-body -->
		</div>
          <!-- /.card -->
			<!-- /.card -->
			<div class="row">
				<div class="col-12">
				<a href="{{ path('app_marches') }}" class="btn btn-secondary mb-5">Annuler</a>
				<input type="submit" value="Enregistrer" class="btn btn-primary float-right" formnovalidate>
				</div>
			</div>
		{{ form_end(form) }}
    </section>
    <!-- /.content -->

				
	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Nouvelle société</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="alert alert-danger d-none" id="alert-errors">
						<h5><i class="icon fas fa-ban"></i> Erreurs!</h5>
						<div id="list_errors">
						</div>
					</div>
					{{ form_start(form2, {'action': path('app_new_ajax_societes'), 'method': 'POST'}) }}
						{{ form_row(form2.name) }}
						{{ form_row(form2.code_societe) }}
						{{ form_row(form2.adresse) }}
						{{ form_row(form2.titulaire) }}

						<input type="button" value="Enregistrer" class="btn btn-primary btn-block my-3 add_societe" formnovalidate>
					{{ form_end(form2) }}
				</div>
			</div>
		</div>
	</div>
				
			

{% endblock %}


{% block javascript %}
<script>

$("#marche_unique_fontionnementInvestissement").on('change', function() {
  //alert( this.value );

  $.ajax('/ligne/type/'+this.value, {
    type: 'GET',  // http method
    success: function (data, status, xhr) {
        console.log(data);
		$('#marche_unique_lineBudgetaire').empty();
		$('#marche_unique_lineBudgetaire').append('<option value="0">Séléctionner Ligne Budgétaire</option>');
		var option = '';
			for (var i=0;i<data.length;i++){
   			option += '<option value="'+ data[i]['ligne_id'] + '">' + data[i]['ligne_rubrique'] + '</option>';
			}
		$('#marche_unique_lineBudgetaire').append(option);
    },
    error: function (jqXhr, textStatus, errorMessage) {
            console.log('Error' + errorMessage);
    }
});

});



$("#marche_unique_titulaire").on('change', function() {
  //alert( this.value );

  $.ajax('/societe/type/'+this.value, {
    type: 'GET',  // http method
    success: function (data, status, xhr) {
        console.log(data);
		$('#marche_unique_societe').empty();
		$('#marche_unique_societe').append('<option value="0">Séléctionner Société</option>');
		var option = '';
			for (var i=0;i<data.length;i++){
   			option += '<option value="'+ data[i]['societe_id'] + '">' + data[i]['societe_rubrique'] + '</option>';
			}
		$('#marche_unique_societe').append(option);
    },
    error: function (jqXhr, textStatus, errorMessage) {
            console.log('Error' + errorMessage);
    }
});

});




$("#marche_unique_tfs").on('change', function() {
  console.log( $(this).val() );
  console.log( $("#marche_unique_typeMarche").val() );

if($("#marche_unique_typeMarche").val() ==0 || $("#marche_unique_typeMarche").val() ==1)
  $.ajax('/natureUC/type/'+this.value, {
   type: 'GET',  // http method
    success: function (data, status, xhr) {
        console.log(data);
		$('#marche_unique_natureOperation').empty();
		$('#marche_unique_natureOperation').append('<option value="0">Selectionner la nature opération</option>');
		var option = '';
			for (var i=0;i<data.length;i++){
   			option += '<option value="'+ data[i]['nature_id'] + '">' + data[i]['nature_rubrique'] + '</option>';
			}
		$('#marche_unique_natureOperation').append(option);
    },
    error: function (jqXhr, textStatus, errorMessage) {
            console.log('Error' + errorMessage);
    }
});
else
{
	  $.ajax('/natureR/type/'+this.value, {
   type: 'GET',  // http method
    success: function (data, status, xhr) {
        console.log(data);
		$('#marche_unique_natureOperation').empty();
		$('#marche_unique_natureOperation').append('<option value="0">Selectionner la nature opération</option>');
		var option = '';
			for (var i=0;i<data.length;i++){
   			option += '<option value="'+ data[i]['nature_id'] + '">' + data[i]['nature_rubrique'] + '</option>';
			}
		$('#marche_unique_natureOperation').append(option);
    },
    error: function (jqXhr, textStatus, errorMessage) {
            console.log('Error' + errorMessage);
    }
});
}

});



$("#marche_unique_typeMarche").on('change', function() {
  console.log( $(this).val() );
  console.log( $("#marche_unique_tfs").val() );

if($(this).val() ==0 || $(this).val() ==1)
  $.ajax('/natureUC/type/'+this.value, {
   type: 'GET',  // http method
    success: function (data, status, xhr) {
        console.log(data);
		$('#marche_unique_natureOperation').empty();
		$('#marche_unique_natureOperation').append('<option value="0">Selectionner la nature opération</option>');
		var option = '';
			for (var i=0;i<data.length;i++){
   			option += '<option value="'+ data[i]['nature_id'] + '">' + data[i]['nature_rubrique'] + '</option>';
			}
		$('#marche_unique_natureOperation').append(option);
    },
    error: function (jqXhr, textStatus, errorMessage) {
            console.log('Error' + errorMessage);
    }
});
else
{
	  $.ajax('/natureR/type/'+this.value, {
   type: 'GET',  // http method
    success: function (data, status, xhr) {
        console.log(data);
		$('#marche_unique_natureOperation').empty();
		$('#marche_unique_natureOperation').append('<option value="0">Selectionner la nature opération</option>');
		var option = '';
			for (var i=0;i<data.length;i++){
   			option += '<option value="'+ data[i]['nature_id'] + '">' + data[i]['nature_rubrique'] + '</option>';
			}
		$('#marche_unique_natureOperation').append(option);
    },
    error: function (jqXhr, textStatus, errorMessage) {
            console.log('Error' + errorMessage);
    }
});
}

});


</script>
{% endblock %}